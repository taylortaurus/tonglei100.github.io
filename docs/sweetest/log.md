# Sweetest 更新日志


## 版本 1.2.6 (20200925)

修复 bug：

1. 修复 http 请求数据中有中文时报错
2. 修复 bug #24 测试数据中 "\<" 无法正常转义成 ”<“ 

### 重大预告：

即将推出 Sweetest 的升级版：Sweet 框架

1. 优化、统一和简化书写格式，用例编写将更加简洁
2. 支持通过 api 接口启动，提供数据库表结构定义
3. 支持自定义关键字模块，提供统一的开发规范及示例
4. 支持多端测试，一份用例启动多个浏览器、App
5. 支持多份测试套件并行测试
6. 更新 logo
7. 删减 Excel格式、JUnit格式的测试报告


## 版本 1.2.5 (20200902)

1. 支持下拉框的选择

支持按 index，value，visible_text 方式选择，如

| 操作  | 页面   | 元素   | 测试数据     |
| --- | ------  | ------ | ----------- |
| 选择  | 百度   | 下拉框 | index=0     |

需要多选时，按如下方式书写：

| 操作  | 页面   | 元素   | 测试数据     |
| --- | ------  | ------ | ----------- |
| 选择  | 百度   | 下拉框 | value0=广东,value1=江苏 |

支持混合方式多选：

| 操作  | 页面   | 元素   | 测试数据     |
| --- | ------  | ------ | ----------- |
| 选择  | 百度   | 下拉框 | index=0, value=江苏 |

visible_text 可以简写为 text：

| 操作  | 页面   | 元素   | 测试数据     |
| --- | ------  | ------ | ----------- |
| 选择  | 百度   | 下拉框 | text=江苏    |

2. 支持取消下拉框选择

取消全部选择

| 操作     | 页面    | 元素   | 测试数据     |
| -------- | ------ | ------ | ----------- |
| 取消选择  | 百度   | 下拉框  | all=yes    |

取消选择的测试数据格式同选择关键字：

| 操作     | 页面    | 元素   | 测试数据     |
| -------- | ------ | ------ | ----------- |
| 取消选择  | 百度   | 下拉框  | index=0    |

3. 支持 MongoDB 集群的连接

在 Elements.xlsx 文件中定义 MongoDB 连接参数，host以逗号(,)分隔,字段以双逗号(,,)分隔

| page | element | by  | value             |
| ---  | ------- | --- | ----------------- |
|mongo | config |   |type=Mongodb,,host=172.21.1.1,172.21.1.2,172.21.1.3,,port=27017,,dbname=stock|

4. fix bug，修复标签页管理错误的bug


## 版本 1.2.4 (20200731)

1. fix bug，用例组合支持 MAIN,SUB
2. 代码优化


## 版本 1.2.3 (20200710)

1. 支持全局等待时间

在需要开始等待的步骤的测试数据中，写 `#wait_times=n`，如：

| 操作  | 页面   | 元素   | 测试数据     |
| --- | ------  | ------ | ---------------- |
| 检查  | 百度  | 搜索按钮 | text=测试，`#wait_times=3` |

如果想取消全局等待时间，在需要的步骤中写 `#wait_times=0`
设置了全局等待时间后，亦可在步骤设置 `等待时间`，该步骤将按 `等待时间` 来等待。

同时，本次优化了部分字段名称，如 `等待时间` 改为 `#wait_time`，同时仍然支持原有写法。

优化字段如下：

| 原字段        | 新的标准写法 |
| -----------  | -----------  |
| 全局等待时间  | #wait_times  |
| 等待时间      | #wait_time   |
| 标签页名      | #tab_name    |
| 打开方式      | #open_type   |
| 循环结束条件  | #break       |
| #ScreenShot  | #screen_shot |
| #ElementShot | #element_shot|

## 版本 1.2.3 (20200710)

1. 支持执行`用例组合`

用例组合：即一组测试用例。`用例编号`中如果有 # 号则该用例属于用例组合，第一个 # 号前的字符串为组合名称

| 用例编号   | 用例标题  | 前置条件   | 测试步骤 |
| --------- | --------- | --------- | ------- |
| buy#find  | 查找      |           | 1       |
|           |           |           | 2       |
| buy#order | 下单      |           | 1       |
| buy#pay   | 支付      |           | 1       |

如上3个用例同属于用例组合 `buy`，那么我们可以用如下方式循环调用

| 用例编号   | 用例标题  | 前置条件  | 测试步骤 | 操作  | 页面      | 元素    | 测试数据 |
| --------- | -------- | --------- | ------- |-------| --------- | ------- | ---------|
| shopping  | 网购     |           | 1       | `执行` | `用例组合` | `buy`*2 | price=<_price>|

元素中的 `buy` 为用例组合名称

我们可以在测试数据中给变量赋值（和执行用例片段的赋值类似）

用例组合执行结果将按顺序添加在测试套件结果的结尾

> 注意：被标记为用例组合的用例默认不执行，只有通过如上的执行步骤才会执行

2. 测试报告支持截图展示

见 [Web 版测试报告](/sweetest/report)

## 版本 1.2.2 (20200629)

支持 [Web 版测试报告](/sweetest/report)


## 版本 1.2 (20200624)

1. MongoDB 支持统计查询

| 操作 | 页面    | 元素                     |  测试数据          |  预期结果  |  输出数据 |
| ---  | ------ | ------------------------ | ----------------- | ---------- | -------- |
| SQL  | mongo   | sql#db.Case.estimated_document_count() |    |            | n=count |

2. MongoDB 查询支持 json 格式比较和取值（同 http 使用方法）

| 操作 | 页面    | 元素                     |  测试数据          |  预期结果  |  输出数据 |
| ---  | ------ | ------------------------ | ----------------- | ---------- | -------- |
| SQL  | mongo   | sql#db.kline.find_one() | json={"symbol": "SZ300789", "price": "\<price\>"},,   |            | symbol=symbol |



## 版本 1.1.1 (20200610)

- 支持 MongoDB 数据库操作

用法：

1. 在 Elements.xlsx 文件中定义 MongoDB 连接参数

| page | element | by  | value             |
| ---  | ------- | --- | ----------------- |
|mongo | config |   |type=Mongodb,host=127.0.0.1,port=27017,dbname=stock|

如果有用户名、密码，value 中需加上：username=xxx,password=xxxxx

2. 测试用例中，按如下格式填写：

| 操作 | 页面    | 元素                     |  测试数据          |  预期结果  |  输出数据 |
| ---  | ------ | ------------------------ | ----------------- | ---------- | -------- |
| SQL  | mongo   | sql#db.kline.find_one() | symbol=SZ300789   |            | symbol=symbol |

其中的元素，sql 值需以 db 开头，kline 为 collection 名，find_one 为 pymongo 库支持的操作。

## 版本 1.1 (20200410)

- 支持 `<<var>>` 变量格式
如 xml 文本，<> 符号较多，则可以使用 <<>> 做变量符，<> 自动变回普通字符

- 支持 '''text''' 文本格式，表示纯文本格式，不做变量解析
如：payload=`'''<?xml version="1.0" encoding="UTF-8"?>'''`

- http POST 请求 Body 支持字符串内容，格式：

| 操作 | 页面    | 元素     |  测试数据                               |  预期结果                |
| ---  | ------ | -------- | -------------------------------------- | ----------------------- |
| POST | Echo   | post请求 | text=`this is a paragraph of text`      | status_code=200       |

- 优化自定义函数解析，抛出自定义函数运行时错误



## 版本 1.0 (2019.12.12)

- 1.0 版本发布

- 后续开发计划：
    - 测试用例数据支持通过 API 导入
    - 支持纯英文编写用例
    - 架构优化，支持添加自定义关键字或关键字模块

- 不做的事情：
    - 原则上不再主动添加关键字模块（如：Dubbo 接口）
    - 不会实现 web 版管理平台系统，有需要可自行使用 API 对接

- 问题解答：
    - 因精力有限，QQ 上不再解答问题
    - 如果你真的想咨询，可以试着赞赏一下



## 版本 0.9.21 (2019.11.29)

- 支持按坐标轻点或连续轻点
    - 无法正常输入的时候，可以通过轻点键盘按键坐标来实现输入
    - 无法正常定位元素来轻点的时候，可以通过坐标轻点

| 操作  | 页面  | 元素                    | 测试数据  |
| ----- | ---- | ----------------------- | ---------|
| 轻点  | 键盘  | 34,741                  |          |
| 轻点  | 键盘  | 34,741\|46,578\|155,584 |          |


## 版本 0.9.20 (2019.11.22)

- 移动端测试支持关键字：锁屏状态，解锁，锁屏，重启

如下，我们可以对手机的锁屏状态进行判断（步骤1），如果是锁屏状态则解锁（步骤2，3，4），然后启动 APP 初始界面
 
|前置条件 | 测试步骤 | 操作     | 页面 | 元素                         |
| ------- | ------- | ------- | ---- | --------------------------- |
| SETUP	  |   ^1    | 锁屏状态 |      |                             | 	
|         |   >2    | 解锁	   |      |                             |
|         |   >3    | 滑动     |      |500,2000\|500,1000           |
|         |   >4    | 轻点     |      |d#1\|d#2\|d#3\|d#4\|d#5\|d#6 |
|         |    5    | 重启     |      |                             |



## 版本 0.9.18 (2019.11.07)

- 修复 Android 截图失败的 bug
- 测试数据文件支持唯一数据和通用数据混写

| `_date`  | `_code`   | `flag` |
| -------- | -------- | ------ |
|          | 000001   |  N     |
|          | 000002   |  N     |
|          | 000003   |  N     |
|          | `&quot;` |  N     |
| 20101107 |          |        |
| 20101108 |          |        |
| 20101109 |          |        |
| 20101110 |          |        |

- 说明：
    - flag 为 N 的行，是普通数据，每次执行都会读取
    - flag 为空的行，是唯一数据行，每次只读取一行
    - 单元格为空字符时，不会读取
    - 如果想设置字段为空字符，应该写：`&quot;`，如上表第4行数据的 _code 列的值



## 版本 0.9.17 (2019.09.30)

- elements.xlsx 中 value 支持 <> 变量
- http 测试的日志，显示发送的参数
- 测试报告显示输出的真实值


## 版本 0.9.16 (2019.09.20)

- 修复：http 测试提示键 text 错误的 bug
- 截图比较支持：按坐标涂白和剪切处理后，再比较

    - 测试数据中，有 `#blank` 时，涂白对应的区域，其中 () 中的坐标为 ( left, upper, right, lower)
    - 测试数据中，有 `#cut` 时，截取对应区域
    - 同时有 `#blank` 和 `#cut` 时，先涂白后截图

| 操作  | 页面     | 元素    | 测试数据 |
| ----- | ------- | ------- | ---------|
| 点击  | 百度     | 搜索按钮 | `#ElementShot=button.png,, #blank=[(30,10,60,25),(65,10,70,25)],, #cut=(15,7,80,25)` |

- inJSON 支持二级列表比较：二级列表的元素坐标必须对应，可以使用空元素来占位。

请更新 inJSON
```shell
pip install -U injson
```


## 版本 0.9.14 (2019.09.12)

- 修复：测试数据为数值时报错的 bug

- 修复：文件夹不存在的 bug

- 优化：当前置条件失败时，未执行用例结果设置为 blocked

- http 接口测试，支持检查响应时间

在预期结果中写 `time=1`，表示预期响应时间小于1秒。

| 操作 | 页面    | 元素     |  测试数据                               |  预期结果                |
| ---  | ------ | -------- | -------------------------------------- | ----------------------- |
| GET  | Echo   | get请求  | params={'foo1': 'bar1', 'foo2': 'bar2'},, | status_code=200,,`time=1` |


## 版本 0.9.12 (2019.08.30)

- 优化执行日志

- 优化失败信息

- 点击支持js点击模式

当无法正常点击到元素时，可以指定用 js 强制点击，只需要在测试数据里写上：`mode=js`

| 操作    | 页面    | 元素     |  测试数据  |
| ------  | ------ | -------- | ---------- |
| `点击`  | 百度    | 搜索按钮  | `mode=js` |


- 把测试数据文件中的对应数据全部循环执行，则循环次数写为 `N`,即 `SNIPPET_ID*N`，如：

| 操作  | 页面    | 元素             | 测试数据       |
| ----- | ------- | --------------- | ------------- |
| 执行  | 用例片段 | `SNIPPET_001*N` |  `kw=<_kw>`   |

- 支持随机数

<> 运算中支持直接使用 random 库，如：指定范围的一个随机整数，写作

| 操作   | 页面    | 元素   | 测试数据 |
| ------ | ------ | ------ | ------- |
| `输入`  | 百度   | 搜索框 |   `<random.randint(1,10)>,,`  |

注意用双逗号分割。

详细使用方法可参见文章：https://www.cnblogs.com/skyEva/p/6097157.html


## 版本 0.9.11 (2019.08.02)

- 支持文件操作，如：复制，移动，删除，文件判断，文件夹判断
- 支持命令行操作

详细说明见文档 ## 文件及命令行 章节


## 版本 0.9.10 (2019.07.19)

- JUnit 报告文件中，增加 blocked, skipped 统计
- 输入关键字：如果输入是具有联想下拉菜单时 可能需要逐字输入功能（模拟真实的键盘输入场景），应写为 `word=...`,如：

| 操作    | 页面    | 元素   | 测试数据 |
| ------- | ------  | ----- | ------- |
| `输入`  | 百度搜索页 | 搜索框 | word=搜狗 |

- 截图比较：现在的截图对比的输出图片可以显示差异部分了
- 优化截图的文件名


## 版本 0.9.8 (2019.07.05)

- 点击操作：当元素为不可点击状态时，等待1秒后再次点击
- 变量替换：测试数据中出现非变量标识的 `<` 或 `>` 时，需要用反斜杠(`\`)转义，如 `\<`，`\>`



## 版本 0.9.7 (2019.06.21)

- 域名更改：

文档：https://sweeter.io

社区: https://o.sweeter.io (精力有限，无法及时维护，有问题建议在 Github 上提 issue)

- 增加左侧入参函数功能（简称：左侧函数），用于检查关键字中。

| 操作  | 页面   | 元素  | 测试数据    |
| ----- | ----- | ----- | ---------- |
| 检查  |  首页 |  金额  |  text=`:f(v, 100),,` |

如上表，冒号(:)开头表示后面为左侧函数，f 为函数名，v 表示等号(=)左侧的值，100 是其他参数(可以为变量，如`<p>`)。

注意:

    - 用例里 f 的第一个参数一定要是 v
    - 以双逗号(,,)分割

- 增加内置左侧函数 f，用来比较数值。

如：实际值 text='1,234.567'，预期值：p=1234.57，当浮点精度为2时，测试数据写作：`text=:f(v, <p>, 2)`，结果为通过

如果预期值：p='1,234.57'，为字符串，则 <p> 需要带引号：`text=:f(v, '<p>', 2)`

当浮点精度为3时，测试数据写作：`text=:f(v, <p>, 3)`，结果为失败


- 当需要自定义左侧函数时，请在 c.py 或 u.py 中定义，测试用例中，应该写作：text=`:c.myfunc(v, 'foo')`

- 优化变量替换函数


## 版本 0.9.6 (2019.06.13)

- Windows GUI 测试：支持 selected, checked, enabled, visible, focused 等状态检查
- Windows GUI 测试：支持重置窗口(即关闭其他窗口，直到指定窗口在最前面)
- 优化 float 比较
- 编写一小部分 Windows GUI 自动化测试文档


## 版本 0.9.5 (2019.06.06)

- Windows GUI 测试：支持右击关键字
- Windows GUI 测试：支持截图和截图对比（用法和 Web 中一致）
- SQL 测试：支持 sql 语句中使用函数，如：select Round(price*6, 4) as p from product;


## 版本 0.9.3 (2019.05.31)

- Windows GUI 测试支持检查关键字，检查内容包括：text，value
- 支持输出 text，value
- 支持 win32、uia 混合模式测试
- 优化菜单关键字对 uia 模式的支持
- notepad 用例增加新功能示例


## 版本 0.9.2 (2019.05.13)

- 支持滚动条操作

对于页面已加载的元素，如果该元素不在可视区域，则框架会自动尝试滚动到元素可见；但有以下2种情况不适用
1. 动态加载的元素(即尚未加载的元素)
2. 内嵌滚动条中被遮挡的元素

对应的，滚动条操作的对象可以是整个页面，也可以是有滚动条的内嵌窗口

- 整个页面格式如下表，元素为空，测试数据为滚动位移，默认值为竖轴(y)，也可以设置横轴(x)

| 操作  | 页面   | 元素  | 测试数据    |
| ----- | ----- | ----- | ---------- |
| 滚动条 |  首页 |       |  10000     |

测试数据也可以写：`y=1000` 或 `x=500` 或 `y=1000,x=500`

- 内嵌滚动条格式，测试数据如页面格式。

| 操作  | 页面   | 元素     | 测试数据    |
| ----- | ----- | -------- | ---------- |
| 滚动条 |  首页 | timeline |  10000     |

## 版本 0.9.1 (2019.04.30)

- 支持在 Web UI 测试中添加自定义 cookie

| 操作 | 页面 | 元素 | 测试数据 |
| --- | --- | --- | ---|
| 打开 | 通用|百度首页 | 标签页名=百度,,cookie={'domain':'.baidu.com', 'name': 'SWEETEST', 'value': '888888'}|

cookie 可以是通过自定义函数获取

| 操作 | 页面 | 元素 | 测试数据 |
| --- | --- | --- | ---|
| 打开 | 通用|百度首页 | 标签页名=百度,cookie=<c.get_cookie()>|



## 版本 0.9.0 (2019.04.26)

- 初步支持 Windows GUI 测试
- 增加测试 Windows 记事本的实例
- 修复 bug：sweetest 命令会创建一个多余的log文件
- 优化：Excel 测试结果中，测试数据显示变量值
- 优化：Excel 汇总结果中，增加执行失败用例列表

体验 Windows GUI 示例，请先自行安装依赖库

`pip install pypiwin32`

`pip install pywinauto`



## 版本 0.8.51 (2019.04.15)

- 修复 bug：比较全屏截图功能-实际上没有截图
- 优化：在 headless 模式下，截图为整个页面

    - 之前的截图功能只能是屏幕可见区域（IE 浏览器可截图整个页面）
    - 现在优化为在 headless 模式下，截图是整个页面，但 Chrome/Firefox 正常模式还是无法截取整个页面


## 版本 0.8.50 (2019.03.27)

- 支持在 `<>` 中取 list 中的值

  > 如：已通过自定义脚本赋值了 queue = `[[1,2,3],[4,5,6]]`, 则 `<queue[0][1]>` 值为 `2`

- 支持在 `<>` 中取 dict 的键值

  > 如：已通过自定义脚本赋值了 apple = `{'color': 'red'}`, 则 `<apple['color']>` 值为 `'red'`


## 版本 0.8.46 (2019.03.14)

- logo 更新
- 修复 bug


## 版本 0.8.43 (2019.03.05)

- Excel 测试报告中增加汇总信息页
- Excel 测试报告目录优化
- 代码美化


## 版本 0.8.41 (2019.03.01) 

- 支持在启动脚本设置全局截屏模式
- 支持在输出数据中填写全屏或元素截图，并赋值给变量
- 支持全屏或元素截图对比
 
 详情见文档**全屏及元素截图比较**章节。


## 版本 0.8.39 (2019.02.22) 

- 支持 headless 模式
- 修复`变量赋值`关键字无效的 bug
- 优化：把`等待时间`的执行顺序提前到`变量替换`之前